<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Voucher - TKĐK Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <style>
        :root {
            --primary-color: #4F46E5;
            --primary-dark: #4338CA;
            --primary-light: #EEF2FF;
            --success-color: #10B981;
            --success-dark: #059669;
            --success-light: #D1FAE5;
            --warning-color: #F59E0B;
            --warning-dark: #D97706;
            --warning-light: #FEF3C7;
            --danger-color: #EF4444;
            --danger-light: #FEE2E2;
            --text-dark: #1F2937;
            --text-gray: #4B5563;
            --text-light: #9CA3AF;
            --bg-light: #F9FAFB;
            --bg-body: #F3F4F6;
            --border-color: #D1D5DB;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body); 
            color: var(--text-dark);
            margin: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .main-wrapper { display: flex; min-height: 100vh; }
        .sidebar {
            width: 260px; background-color: #fff; border-right: 1px solid var(--border-color);
            padding-top: 0; box-shadow: var(--shadow-sm); display: flex; flex-direction: column;
            position: fixed; top: 0; bottom: 0; left: 0; z-index: 1000;
        }
        .sidebar .sidebar-brand {
            padding: 1.25rem 1.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; gap: 0.75rem; font-size: 1.25rem;
            font-weight: 600; color: var(--text-dark); text-decoration: none;
        }
        .sidebar .sidebar-brand img { height: 32px; }
        .sidebar .sidebar-brand span { font-weight: 700; }
        .sidebar .nav { padding-left: 0; margin-bottom: 0; list-style: none; flex-grow: 1; overflow-y: auto; }
        .sidebar .nav-link {
            display: flex; align-items: center; gap: 0.875rem; padding: 0.85rem 1.5rem;
            color: var(--text-gray); font-weight: 500; border-left: 3px solid transparent;
            transition: all 0.2s ease-in-out; font-size: 0.9rem; text-decoration: none;
            border-radius: 0 var(--radius-md) var(--radius-md) 0; margin-right: 0.5rem;
        }
        .sidebar .nav-link i { width: 20px; text-align: center; font-size: 1rem; color: var(--text-light); }
        .sidebar .nav-link:hover { color: var(--primary-color); background-color: var(--primary-light); border-left-color: var(--primary-color); }
        .sidebar .nav-link:hover i { color: var(--primary-color); }
        .sidebar .nav-link.active {
            color: var(--primary-color); background-color: var(--primary-light);
            border-left-color: var(--primary-color); font-weight: 600;
        }
        .sidebar .nav-link.active i { color: var(--primary-color); }
        .sidebar-footer { padding: 0.75rem 0; border-top: 1px solid var(--border-color); background-color: #fff; }
        .sidebar-footer .nav-link { border-left-color: transparent !important; }
        .sidebar-footer .nav-link:hover { color: var(--danger-color); background-color: var(--danger-light); }
        .sidebar-footer .nav-link:hover i { color: var(--danger-color); }

        .content-area { flex: 1; padding: 2rem; overflow-y: auto; margin-left: 260px; background-color: var(--bg-body); }
        .page-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border-color);
        }
        .page-header h1 { font-size: 1.875rem; font-weight: 700; margin: 0; color: var (--text-dark); }
        .page-header h1 i { color: var(--primary-color); }
        
        .stat-card {
            background: white; border-radius: var(--radius-lg); padding: 1.75rem;
            display: flex; align-items: center; transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            border: 1px solid var(--border-color); box-shadow: none;
        }
        .stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); border-color: var(--primary-color); }
        .stat-card-icon {
            width: 48px; height: 48px; border-radius: var(--radius-md);
            display: flex; align-items: center; justify-content: center;
            margin-right: 1.25rem; font-size: 1.5rem;
        }
        .stat-card-icon.total { background-color: var(--primary-light); color: var(--primary-color); }
        .stat-card-icon.active-stat { background-color: var(--success-light); color: var(--success-color); }
        .stat-card-icon.expired { background-color: var(--warning-light); color: var(--warning-color); }
        .stat-info h4 {
            margin: 0 0 0.25rem 0; font-size: 0.8rem; color: var(--text-gray);
            font-weight: 500; text-transform: uppercase; letter-spacing: 0.04em;
        }
        .stat-info p { margin: 0; font-size: 1.875rem; font-weight: 700; color: var(--text-dark); }

        .card { border: 1px solid var(--border-color); box-shadow: none; border-radius: var(--radius-lg); }
        .card-header {
            background-color: var(--bg-light) !important; border-bottom: 1px solid var(--border-color);
            padding: 1rem 1.25rem;
        }
        .card-header h6 { font-weight: 600 !important; color: var(--text-dark) !important; font-size: 1rem; }
        .card-header h6 i { color: var(--primary-color); }
        .btn-primary-gradient {
            background-image: linear-gradient(to right, var(--primary-color) 0%, var(--primary-dark) 100%);
            border: none; color: white;
        }
        .btn-primary-gradient:hover {
            background-image: linear-gradient(to right, var(--primary-dark) 0%, var(--primary-color) 100%);
        }

        .table thead.table-light th {
            background-color: var(--bg-light); color: var(--text-gray); font-weight: 600;
            text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em;
            border-bottom: 2px solid var(--border-color);
        }
        .table td, .table th { vertical-align: middle; padding: 0.85rem; border-bottom: 1px solid var(--border-color); }
        .table th:first-child, .table td:first-child { padding-left: 1.25rem; }
        .table th:last-child, .table td:last-child { padding-right: 1.25rem; }
        .table-hover tbody tr:hover { background-color: var(--primary-light); color: var(--primary-dark); }
        
        .badge { font-size: 0.75rem; padding: 0.35em 0.6em; font-weight: 600; border-radius: var(--radius-sm); }
        .badge.bg-success { background-color: var(--success-color) !important; color: white !important; }
        .badge.bg-warning { background-color: var(--warning-color) !important; color: white !important; }
        .badge.bg-danger { background-color: var(--danger-color) !important; color: white !important; }
        .badge.bg-info { background-color: #3B82F6 !important; color: white !important; } /* Example for 'Upcoming' */


        .modal-header {
            background-color: var(--primary-color) !important; color: white !important;
            padding: 1rem 1.5rem; border-bottom: none;
        }
        .modal-header .modal-title { font-weight: 600; font-size: 1.15rem; }
        .modal-header .btn-close-white { filter: invert(1) grayscale(100%) brightness(200%); }
        .modal-footer { background-color: var(--bg-light); border-top: 1px solid var(--border-color); padding: 1rem 1.5rem; }
        .modal-footer .btn { padding: 0.5rem 1rem; font-weight: 500; }
        .form-control:focus, .form-select:focus { border-color: var(--primary-color); box-shadow: 0 0 0 0.2rem var(--primary-light); }
        .swal2-container { z-index: 1060 !important; }

        /* DataTables specific adjustments */
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 0.4em 0.8em; margin-left: 2px; border-radius: var(--radius-sm);
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button.current, 
        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
            background: var(--primary-color) !important; color: white !important; border-color: var(--primary-color) !important;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: var(--primary-light) !important; color: var(--primary-dark) !important; border-color: var(--primary-dark) !important;
        }
        .dataTables_length select.form-select { width: auto; display: inline-block; }
        .dataTables_filter input.form-control { display: inline-block; width: auto; }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <nav class="sidebar">
            <a class="sidebar-brand" href="/public/index.html">
                <img src="/public/image/AutomotiveCar.png" alt="TKĐK Logo">
                <span>TKĐK Admin</span>
            </a>
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link" href="AdminTrangChu.html"><i class="fas fa-chart-line"></i> Thống Kê</a></li>
                <li class="nav-item"><a class="nav-link" href="AdminQuanLyKH.html"><i class="fas fa-users"></i> Quản Lý Khách Hàng</a></li>
                <li class="nav-item"><a class="nav-link" href="AdminQLXe.html"><i class="fas fa-car"></i> Quản Lý Xe</a></li>
                <li class="nav-item"><a class="nav-link" href="AdminQuanLyNguoiDung.html"><i class="fas fa-user-cog"></i> Quản Lý Người Dùng</a></li>
                <li class="nav-item"><a class="nav-link" href="AdminGiaoDich.html"><i class="fas fa-exchange-alt"></i> Quản Lý Giao Dịch</a></li>
                <li class="nav-item"><a class="nav-link active" href="AdminVoucher.html"><i class="fas fa-ticket-alt"></i> Quản Lý Voucher</a></li>
                <li class="nav-item"><a class="nav-link" href="AdminQuanLyLienHe.html"><i class="fas fa-envelope"></i> Quản Lý Liên hệ</a></li>
            </ul>
            <div class="sidebar-footer">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Đăng Xuất</a></li>
                </ul>
            </div>
        </nav>

        <main class="content-area">
            <div class="page-header">
                <h1><i class="fas fa-ticket-alt me-2"></i>Quản Lý Voucher</h1>
            </div>

            <div class="row mb-4">
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="stat-card h-100">
                        <div class="stat-card-icon total"><i class="fas fa-tags"></i></div>
                        <div class="stat-info">
                            <h4>Tổng số voucher</h4>
                            <p id="totalVouchers">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="stat-card h-100">
                        <div class="stat-card-icon active-stat"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-info">
                            <h4>Đang hoạt động</h4>
                            <p id="activeVouchers">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="stat-card h-100">
                        <div class="stat-card-icon expired"><i class="fas fa-times-circle"></i></div>
                        <div class="stat-info">
                            <h4>Hết hạn/Đã dùng</h4>
                            <p id="expiredVouchers">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light py-3 d-flex flex-wrap align-items-center justify-content-between">
                    <h6 class="m-0 mb-2 mb-md-0"><i class="fas fa-list-ul me-2"></i>Danh sách Voucher</h6>
                    <button class="btn btn-sm btn-primary-gradient" id="addVoucherBtn" data-bs-toggle="modal" data-bs-target="#voucherModal">
                        <i class="fas fa-plus-circle me-1"></i> Thêm Voucher
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="vouchersTable" style="width:100%">
                            <thead class="table-light">
                                <tr>
                                    <th>Mã Voucher</th>
                                    <th>Mô tả</th>
                                    <th>Loại giảm giá</th>
                                    <th>Giá trị</th>
                                    <th>Ngày bắt đầu</th>
                                    <th>Ngày kết thúc</th>
                                    <th>Số lượng</th>
                                    <th>Đã dùng</th>
                                    <th>Trạng thái</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Voucher data will be populated by DataTables -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Voucher Modal -->
    <div class="modal fade" id="voucherModal" tabindex="-1" aria-labelledby="voucherModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"></div>
                    <h5 class="modal-title" id="voucherModalLabel"><i class="fas fa-plus-circle me-2"></i>Thêm Voucher Mới</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="voucherForm">
                    <div class="modal-body p-4">
                        <input type="hidden" id="voucherId">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="voucherCode" class="form-label">Mã Voucher <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="voucherCode" required>
                            </div>
                            <div class="col-md-6">
                                <label for="voucherDiscountType" class="form-label">Loại giảm giá <span class="text-danger">*</span></label>
                                <select class="form-select" id="voucherDiscountType" required>
                                    <option value="percentage">Phần trăm (%)</option>
                                    <option value="fixed_amount">Số tiền cố định (VNĐ)</option>
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label for="voucherDescription" class="form-label">Mô tả</label>
                                <textarea class="form-control" id="voucherDescription" rows="2"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label for="voucherValue" class="form-label">Giá trị giảm <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="voucherValue" required min="0">
                            </div>
                             <div class="col-md-6">
                                <label for="maxDiscountAmount" class="form-label">Giảm tối đa (VNĐ)</label>
                                <input type="number" class="form-control" id="maxDiscountAmount" min="0" placeholder="Để trống nếu không giới hạn">
                                <small class="form-text text-muted">Áp dụng cho loại giảm giá Phần trăm.</small>
                            </div>
                            <div class="col-md-6">
                                <label for="minPurchaseAmount" class="form-label">Giá trị đơn hàng tối thiểu (VNĐ)</label>
                                <input type="number" class="form-control" id="minPurchaseAmount" min="0" value="0">
                            </div>
                            <div class="col-md-6">
                                <label for="voucherQuantity" class="form-label">Số lượng <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="voucherQuantity" required min="0">
                            </div>
                            <div class="col-md-6">
                                <label for="voucherStartDate" class="form-label">Ngày bắt đầu <span class="text-danger">*</span></label>
                                <input type="datetime-local" class="form-control" id="voucherStartDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="voucherEndDate" class="form-label">Ngày kết thúc <span class="text-danger">*</span></label>
                                <input type="datetime-local" class="form-control" id="voucherEndDate" required>
                            </div>
                             <div class="col-md-12">
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" role="switch" id="voucherIsActive" checked>
                                    <label class="form-check-label" for="voucherIsActive">Kích hoạt voucher</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary" id="saveVoucherBtn"><i class="fas fa-save me-1"></i>Lưu Voucher</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.all.min.js"></script>
    <script src="/public/js/adminAuth.js"></script>
    <script src="/public/js/adminVouchers.js"></script>
    <script>
        // Ensure adminAuth.js runs its checks and initializes common elements
        document.addEventListener('DOMContentLoaded', function() {
            // Specific page logic for AdminVoucher can be initialized here if not in adminVouchers.js
            // For example, initializing DataTables if adminVouchers.js doesn't do it.
            // However, it's better to keep such logic within adminVouchers.js for modularity.
        });
    </script>
</body>
</html>